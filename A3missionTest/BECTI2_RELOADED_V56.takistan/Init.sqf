//gui patch added by 0=1

profilenamespace setvariable ['map_blufor_b',0.6]; 
profilenamespace setvariable ['map_independent_a',1.0]; 
profilenamespace setvariable ['map_unknown_presetdefault',"PresetA3"]; 
profilenamespace setvariable ['map_unknown_b',0.0];
profilenamespace setvariable ['igui_grid_stance_x',1.1738367]; 
profilenamespace setvariable ['igui_grid_vehicle_y',-0.08675383]; 
profilenamespace setvariable ['igui_grid_bar_y',0.9082354]; 
profilenamespace setvariable ['igui_grid_comm_x',-0.28267977]; 
profilenamespace setvariable ['igui_grid_gaugestability_x',0.6275]; 
profilenamespace setvariable ['igui_grid_mission_y',0.6682354]; 
profilenamespace setvariable ['gui_grid_center_x',-0.099999994]; 
profilenamespace setvariable ['rscdisplayconfigure_cursel',0.0];
profilenamespace setvariable ['igui_tactping_rgb_a',1.0]; 
profilenamespace setvariable ['map_blufor_r',0.0];
profilenamespace setvariable ['map_independent_b',0.0];
profilenamespace setvariable ['map_unknown_r',0.7];
profilenamespace setvariable ['subtitles_text_presetdefault',"White"]; 
profilenamespace setvariable ['igui_grid_stance_y',-0.087843135]; 
profilenamespace setvariable ['igui_grid_comm_y',0.24901968];
profilenamespace setvariable ['igui_grid_gaugestability_y',0.6202354];
profilenamespace setvariable ['igui_grid_custominforight_w',0.3]; 
profilenamespace setvariable ['igui_grid_custominforight_h',0.39999998];
profilenamespace setvariable ['gui_grid_center_y',0.0]; 
profilenamespace setvariable ['igui_bcg_rgb_g',0.2588]; 
profilenamespace setvariable ['igui_text_rgb_preset',"PresetA2"];
profilenamespace setvariable ['igui_tactping_rgb_b',0.2];
profilenamespace setvariable ['map_independent_presetdefault',"PresetA3"];
profilenamespace setvariable ['map_independent_r',0.0]; 
profilenamespace setvariable ['map_unknown_preset',"PresetA3"]; 
profilenamespace setvariable ['subtitles_text_g',1.0]; 
profilenamespace setvariable ['igui_grid_custominforight_x',-0.2839542];
profilenamespace setvariable ['iguipresetdefault',"Arma3"];
profilenamespace setvariable ['igui_warning_rgb_presetdefault',"PresetA3"];
profilenamespace setvariable ['igui_tactping_rgb_r',1.0];
profilenamespace setvariable ['map_blufor_presetdefault',"PresetA3"];
profilenamespace setvariable ['igui_grid_custominforight_y',0.078300744];
profilenamespace setvariable ['guipresetdefault',"Arma3"];
profilenamespace setvariable ['igui_grid_gaugealt_w',0.0];
profilenamespace setvariable ['igui_grid_gaugealt_h',0.0];
profilenamespace setvariable ['igui_tactping_rgb_presetdefault',"PresetA3"];
profilenamespace setvariable ['igui_tactping_rgb_preset',"PresetA2"];
profilenamespace setvariable ['map_blufor_preset',"PresetA3"];
profilenamespace setvariable ['igui_grid_gaugealt_x',0.14749998]; 
profilenamespace setvariable ['rscdisplaygameoptions_listtagscursel',0.0]; 
profilenamespace setvariable ['igui_grid_notification_w',0.0]; 
profilenamespace setvariable ['igui_grid_notification_h',0.0]; 
profilenamespace setvariable ['igui_grid_gaugecompass_w',0.0]; 
profilenamespace setvariable ['igui_grid_gaugecompass_h',0.0]; 
profilenamespace setvariable ['igui_warning_rgb_a',1.0];
profilenamespace setvariable ['igui_error_rgb_preset',"PresetA2"]; 
profilenamespace setvariable ['gui_bcg_rgb_a',0.8]; 
profilenamespace setvariable ['map_blufor_g',0.3];
profilenamespace setvariable ['map_civilian_presetdefault',"PresetA3"]; 
profilenamespace setvariable ['map_civilian_a',1.0]; 
profilenamespace setvariable ['map_unknown_g',0.6];
profilenamespace setvariable ['igui_grid_notification_x',0.32]; 
profilenamespace setvariable ['igui_grid_gaugealt_y',0.6202354]; 
profilenamespace setvariable ['igui_grid_gaugecompass_x',0.8675]; 
profilenamespace setvariable ['iguipreset',""];
profilenamespace setvariable ['igui_text_rgb_a',1.0];
profilenamespace setvariable ['igui_warning_rgb_b',0.0]; 
profilenamespace setvariable ['igui_error_rgb_a',1.0]; 
profilenamespace setvariable ['gui_bcg_rgb_b',0.08];
profilenamespace setvariable ['gui_titletext_rgb_presetdefault',"PresetRCgold"]; 
profilenamespace setvariable ['map_independent_g',0.5]; 
profilenamespace setvariable ['map_civilian_b',0.5];
profilenamespace setvariable ['igui_grid_notification_y',0.17176467]; 
profilenamespace setvariable ['igui_grid_gaugecompass_y',0.6202354]; 
profilenamespace setvariable ['igui_grid_gaugehorizon_w',0.0]; 
profilenamespace setvariable ['igui_grid_gaugehorizon_h',0.0];
profilenamespace setvariable ['igui_bcg_rgb_presetdefault',"PresetA3"]; 
profilenamespace setvariable ['igui_text_rgb_b',0.47];
profilenamespace setvariable ['igui_warning_rgb_r',0.863];
profilenamespace setvariable ['igui_error_rgb_presetdefault',"PresetA3"]; 
profilenamespace setvariable ['igui_error_rgb_b',0.0196]; 
profilenamespace setvariable ['igui_tactping_rgb_g',0.8]; 
profilenamespace setvariable ['gui_bcg_rgb_r',0.035628892]; 
profilenamespace setvariable ['gui_titletext_rgb_a',1.0];
profilenamespace setvariable ['map_opfor_presetdefault',"PresetA3"]; 
profilenamespace setvariable ['map_opfor_a',1.0];
profilenamespace setvariable ['map_civilian_r',0.4];
profilenamespace setvariable ['subtitles_background_preset',"White"]; 
profilenamespace setvariable ['subtitles_background_a',0.0];
profilenamespace setvariable ['igui_grid_gaugehorizon_x',0.38750002]; 
profilenamespace setvariable ['guipreset',""];
profilenamespace setvariable ['igui_grid_custominfoleft_w',0.3];
profilenamespace setvariable ['igui_grid_custominfoleft_h',0.39999998]; 
profilenamespace setvariable ['igui_text_rgb_presetdefault',"PresetA3"]; 
profilenamespace setvariable ['igui_text_rgb_r',0.6];
profilenamespace setvariable ['igui_error_rgb_r',0.706]; 
profilenamespace setvariable ['gui_titletext_rgb_b',0.0];
profilenamespace setvariable ['map_opfor_preset',"PresetA3"]; 
profilenamespace setvariable ['map_opfor_b',0.0];
profilenamespace setvariable ['subtitles_background_b',0.0];
profilenamespace setvariable ['igui_grid_gaugehorizon_y',0.6202354]; 
profilenamespace setvariable ['igui_grid_custominfoleft_x',0.9872224]; 
profilenamespace setvariable ['igui_grid_hint_w',0.0]; 
profilenamespace setvariable ['igui_grid_hint_h',0.0]; 
profilenamespace setvariable ['igui_grid_menu_w',0.135]; 
profilenamespace setvariable ['igui_grid_menu_h',0.432];
profilenamespace setvariable ['igui_grid_gaugespeed_w',0.0]; 
profilenamespace setvariable ['igui_grid_gaugespeed_h',0.0]; 
profilenamespace setvariable ['gui_titletext_rgb_r',0.0]; 
profilenamespace setvariable ['map_opfor_r',0.5];
profilenamespace setvariable ['subtitles_background_r',0.0]; 
profilenamespace setvariable ['igui_grid_hint_x',0.8943138]; 
profilenamespace setvariable ['igui_grid_menu_x',-0.28261447];
profilenamespace setvariable ['igui_grid_gaugespeed_x',-0.09250003];
profilenamespace setvariable ['igui_grid_custominfoleft_y',0.045621037];
profilenamespace setvariable ['igui_grid_weapon_w',0.3];
profilenamespace setvariable ['igui_grid_weapon_h',0.17999999];
profilenamespace setvariable ['igui_grid_stamina_w',0.3];
profilenamespace setvariable ['igui_grid_stamina_h',0.04];
profilenamespace setvariable ['subtitles_background_presetdefault',"White"];
profilenamespace setvariable ['subtitles_text_preset',"White"];
profilenamespace setvariable ['igui_grid_weapon_x',0.8741046];
profilenamespace setvariable ['igui_grid_stamina_x',0.333255];
profilenamespace setvariable ['igui_grid_hint_y',0.15176468];
profilenamespace setvariable ['igui_grid_menu_y',0.4897603];
profilenamespace setvariable ['igui_grid_gaugespeed_y',0.6202354];
profilenamespace setvariable ['gui_grid_w',1.2]; 
profilenamespace setvariable ['gui_grid_h',1.0];
profilenamespace setvariable ['igui_bcg_rgb_a',0.75];
profilenamespace setvariable ['igui_warning_rgb_g',0.584];
profilenamespace setvariable ['gui_bcg_rgb_preset',""];
profilenamespace setvariable ['gui_bcg_rgb_g',0.448111]; 
profilenamespace setvariable ['gui_titletext_rgb_preset',""];
profilenamespace setvariable ['map_civilian_g',0.0]; 
profilenamespace setvariable ['subtitles_text_a',1.0];
profilenamespace setvariable ['igui_grid_weapon_y',-0.087843165];
profilenamespace setvariable ['igui_grid_stamina_y',-0.092902005];
profilenamespace setvariable ['igui_grid_chat_w',0.6];
profilenamespace setvariable ['igui_grid_chat_h',0.19999999];
profilenamespace setvariable ['gui_grid_x',-0.28431377];
profilenamespace setvariable ['igui_bcg_rgb_b',0.149];
profilenamespace setvariable ['igui_text_rgb_g',0.84];
profilenamespace setvariable ['igui_error_rgb_g',0.0745]; 
profilenamespace setvariable ['gui_bcg_rgb_presetdefault',"PresetRCgold"];
profilenamespace setvariable ['subtitles_text_b',1.0];
profilenamespace setvariable ['igui_grid_chat_x',-0.047614455]; 
profilenamespace setvariable ['gui_grid_y',0.08823538]; 
profilenamespace setvariable ['igui_bcg_rgb_preset',"PresetA2"];
profilenamespace setvariable ['igui_bcg_rgb_r',0.1882]; 
profilenamespace setvariable ['gui_titletext_rgb_g',0.0];
profilenamespace setvariable ['map_opfor_g',0.0];
profilenamespace setvariable ['map_independent_preset',"PresetA3"];
profilenamespace setvariable ['subtitles_background_g',0.0];
profilenamespace setvariable ['subtitles_text_r',1.0];
profilenamespace setvariable ['igui_grid_chat_y',0.70854044];
profilenamespace setvariable ['igui_grid_vehicle_w',0.3];
profilenamespace setvariable ['igui_grid_vehicle_h',0.17999999]; 
profilenamespace setvariable ['igui_grid_bar_w',0.0]; 
profilenamespace setvariable ['igui_grid_bar_h',0.0];
profilenamespace setvariable ['igui_grid_mission_w',0.0]; 
profilenamespace setvariable ['igui_grid_mission_h',0.0];
profilenamespace setvariable ['igui_warning_rgb_preset',"PresetA2"];
profilenamespace setvariable ['map_blufor_a',1.0];
profilenamespace setvariable ['map_civilian_preset',"PresetA3"]; 
profilenamespace setvariable ['map_unknown_a',1.0];
profilenamespace setvariable ['igui_grid_vehicle_x',-0.2840196]; 
profilenamespace setvariable ['igui_grid_bar_x',-0.25431377]; 
profilenamespace setvariable ['igui_grid_mission_x',0.6543138]; 
profilenamespace setvariable ['gui_grid_center_w',1.2]; 
profilenamespace setvariable ['gui_grid_center_h',1.0];
profilenamespace setvariable ['igui_grid_stance_w',0.11100001];
profilenamespace setvariable ['igui_grid_stance_h',0.148];
profilenamespace setvariable ['igui_grid_comm_w',0.045];
profilenamespace setvariable ['igui_grid_comm_h',0.59999996]; 
profilenamespace setvariable ['igui_grid_gaugestability_w',0.0];
profilenamespace setvariable ['igui_grid_gaugestability_h',0.0];


//["<img image='PathToImageHere' />",0,0.5,99999,5,0,9459] spawn bis_fnc_dynamicText;
//9459 cutText ["","PLAIN",0]

//player need set menu scale on big now (HUD IS MADE FOR BIG SETTING)
_uiscale= getResolution;
_uiscale=_uiscale#5;
if (!((_uiscale) > 0.84)|| !((_uiscale) < 0.86))  then {
	//titleText ["PLEASE SET YOUR MENU SCALE ON BIG NOW AND JOIN AGAIN AFTER ARMA RESTART", "BLACK FADED", 20];
	titleText ["PLEASE SET YOUR MENU SCALE ON LARGE NOW AND JOIN AGAIN AFTER ARMA RESTART", "PLAIN", 20];
	["<img align = 'center' img size='18' image='RSC\Pictures\helppicture.paa' />",0,0,99999,5,0,9459] spawn bis_fnc_dynamicText;
	9459 cutText ["","PLAIN",0];
	
	
	sleep 20;
	failMission "END1";
};

//set map texture off at start
//ctrlActivate ((findDisplay 12) displayCtrl 107);


//#define CA_UI_ACTION			{0.9,0.9,0.9,0.4}

//#define COLOR_TASK_BACKGROUND_UNASSIGNED_RGB		1,1,1
//#define COLOR_TASK_BACKGROUND_UNASSIGNED_A		1

//#define CA_IGUI_GreenDark		{0.259,0.463,0.149, 1} 

//#define CA_UI_element_background	Color_White
//#define CA_UI_background		{0.6, 0.6, 0.6, 0.4}

//#define COLOR_TASK_ICON_UNASSIGNED_RGB		1,1,1
//#define COLOR_TASK_ICON_UNASSIGNED_A		0.5

//end gui patch


//--- Define which 'part' of the game to run.
#include "version.sqf"

//WF_Debug = false;
WF_Debug = true;
#ifdef WF_DEBUG
	WF_Debug = true;
#endif




WF_Skip_Intro = true;
#ifdef WF_SKIP_INTRO
	WF_Skip_Intro = true;
#endif

WF_Camo = false;
#ifdef WF_CAMO
	WF_Camo = true;
#endif

//--- Global Init, first file called.
isHostedServer = if (isServer && !isDedicated) then {true} else {false};
isHeadLessClient = false;
//--- Headless Client?
isHeadLessClient = if (!hasInterface && !isDedicated)then{true}else{false};

if (isHostedServer || (!isHeadLessClient && !isDedicated)) then {
    12452 cutText [(localize 'STR_WF_Loading')+"...","BLACK IN",55555];
};

missionNamespace setVariable ["cti_MAXPLAYERS", WF_MAXPLAYERS];
missionNamespace setVariable ["cti_MISSIONNAME", WF_MISSIONNAME];
cti_CO_FNC_LogContent = Compile preprocessFileLineNumbers "Common\Functions\Common_LogContent.sqf"; //--- Define the log function earlier.
cti_LogLevel = 0; //--- Logging level (0: Trivial, 1: Information, 2: Warnnings, 3: Errors).

//--- Mission is starting.
for '_i' from 0 to 3 do {diag_log "################################"};
diag_log format ["## Island Name: [%1]", worldName];
diag_log format ["## Mission Name: [%1]", WF_MISSIONNAME];
diag_log format ["## Max players Defined: [%1]", WF_MAXPLAYERS];
for '_i' from 0 to 3 do {diag_log "################################"};

["INITIALIZATION", "initJIPCompatible.sqf: Starting JIP Initialization"] Call cti_CO_FNC_LogContent;
cti_Client_SideJoined = civilian;

if (isHeadLessClient) then {["INITIALIZATION", "initJIPCompatible.sqf: Detected an headless client."] Call cti_CO_FNC_LogContent};

//--- Server JIP Information
if ((isHostedServer || isDedicated) && !isHeadLessClient) then { //--- JIP Handler, handle connection & disconnection.
	cti_SE_FNC_OnPlayerConnected = Compile preprocessFileLineNumbers "Server\Functions\Server_OnPlayerConnected.sqf";
	cti_SE_FNC_OnPlayerDisconnected = Compile preprocessFileLineNumbers "Server\Functions\Server_OnPlayerDisconnected.sqf";

	onPlayerConnected {[_uid, _name, _id] Spawn cti_SE_FNC_OnPlayerConnected};
	onPlayerDisconnected {[_uid, _name, _id] Spawn cti_SE_FNC_OnPlayerDisconnected};
};

//--- Client initialization, either hosted or pure client. Part I
if (isHostedServer || (!isHeadLessClient && !isDedicated)) then {
	["INITIALIZATION", "initJIPCompatible.sqf: Client detected... waiting for non null result..."] Call cti_CO_FNC_LogContent;
	waitUntil {!isNull player};
	["INITIALIZATION", "initJIPCompatible.sqf: Client is not null..."] Call cti_CO_FNC_LogContent;
};

setObjectViewDistance 3000; //--- Server & Client default View Distance.
setViewDistance 3000;
[] spawn {enableEnvironment false;};

clientInitComplete = false;
commonInitComplete = false;
serverInitComplete = false;
serverInitFull = false;
cti_GameOver = false;
townInitServer = false;
townInit = false;
towns = [];

if (isMultiplayer) then {Call Compile preprocessFileLineNumbers "Common\Init\Init_Parameters.sqf"}; //--- In MP, we get the parameters.
cti_Parameters_Ready = true; //--- All parameters are set and ready.

Call Compile preprocessFileLineNumbers "Common\Init\Init_CommonConstants.sqf"; //--- Set the constants and the parameters, skip the params if they're already defined.

if (WF_Debug) then { //--- Debug.
	missionNamespace setVariable ["cti_C_GAMEPLAY_UPGRADES_CLEARANCE", 7];
	//missionNamespace setVariable ["cti_C_TOWNS_OCCUPATION", 1];
	//missionNamespace setVariable ["cti_C_TOWNS_DEFENDER", 2];
	//missionNamespace setVariable ["cti_C_TOWNS_STARTING_MODE", 2];
	missionNamespace setVariable ["cti_C_ECONOMY_SUPPLY_START_EAST", 999999];
	missionNamespace setVariable ["cti_C_ECONOMY_SUPPLY_START_WEST", 999999];
	missionNamespace setVariable ["cti_C_ECONOMY_FUNDS_START_EAST", 999999];
	missionNamespace setVariable ["cti_C_ECONOMY_FUNDS_START_WEST", 999999];
	missionNamespace setVariable ["cti_C_MODULE_cti_EASA", 1];
	missionNamespace setVariable ["cti_DEBUG_DISABLE_TOWN_INIT", 0];  // 0 -> disabled, 1 -> enabled
	WSW_AdvDebugger = player;
}else{
    WSW_AdvDebugger = objNull;
};

publicVariable "WSW_AdvDebugger";

["INITIALIZATION", "initJIPCompatible.sqf: Headless client is supported."] Call cti_CO_FNC_LogContent;

//--- Apply the time-environment (don't halt).
[] Spawn {
	waitUntil {time > 0}; //--- Await for the mission to start / JIP.
	setDate [(date select 0),(missionNamespace getVariable "cti_C_ENVIRONMENT_STARTING_MONTH"),(date select 2),(missionNamespace getVariable "cti_C_ENVIRONMENT_STARTING_HOUR"),(date select 4)]; //--- Apply the date and time.
	if (local player) then {skipTime (time / 3600)}; //--- If we're dealing with a client, he may have JIP half way through the game. Sync him via skipTime with the mission time.
	sleep 2;
};

ExecVM "Common\Init\Init_Common.sqf"; //--- Execute the common files.
ExecVM "Common\Init\Init_Towns.sqf"; //--- Execute the towns file.

//--- Server initialization.
if (isHostedServer || isDedicated) then { //--- Run the server's part.
	["INITIALIZATION", "initJIPCompatible.sqf: Executing the Server Initialization."] Call cti_CO_FNC_LogContent;
	ExecVM "Server\Init\Init_Server.sqf";
};

//--- Client initialization, either hosted or pure client. Part II
if (isHostedServer || (!isHeadLessClient && !isDedicated)) then {
	waitUntil {!isNil 'cti_PRESENTSIDES'}; //--- Await for teams to be set before processing the client init.
	{
		_logik = (_x) Call cti_CO_FNC_GetSideLogic;
		waitUntil {!isNil {_logik getVariable "cti_teams"}};
		missionNamespace setVariable [Format["cti_%1TEAMS",_x], _logik getVariable "cti_teams"];
	} forEach cti_PRESENTSIDES;

	["INITIALIZATION", "initJIPCompatible.sqf: Executing the Client Initialization."] Call cti_CO_FNC_LogContent;

	execVM "Client\Init\Init_Client.sqf";
	waitUntil {clientInitComplete};
	if!(WF_Skip_Intro)then{
	    [] spawn cti_CL_FNC_MissionIntro;
        waitUntil {WSW_EndIntro};
	}else{
	    12452 cutText [(localize 'STR_WF_Loading')+"...","BLACK IN",5];
	};
};

//--- Run the headless client initialization.
if (isHeadLessClient) then { execVM "Headless\Init\Init_HC.sqf"; };



//diag_log "Attempting to initialize Towing Script...";
//[] execVM "core\initTowing.sqf";
[] execVM "Client\Functions\Client_TowVehicle.sqf";

